{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\negis\\\\OneDrive\\\\Desktop\\\\new project\\\\blockfest-ui\\\\src\\\\pages\\\\MarketplacePage.tsx\",\n  _s = $RefreshSig$();\n// src/pages/MarketplacePage.tsx\n\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { toast } from 'react-hot-toast';\nimport { motion } from 'framer-motion';\n// Import specific utilities from ethers\n\n// formatEther is used by blockchain.ts, parseEther for sending tx\n\n// --- Context Hooks ---\nimport { useAuth, useWallet } from '../contexts/AuthContext';\nimport { useVIP } from '../contexts/VIPContext';\n\n// --- Blockchain Utilities ---\nimport { buyTicket as buyTicketUtil, getMyTickets as getMyTicketsUtil, resellTicket as resellTicketUtil, getEventDetails } from '../utils/blockchain';\nimport fetchMetadataFromUri from '../utils/metadata';\n\n// --- Components ---\nimport GlowingButton from '../components/GlowingButton';\nimport VIPVerificationForm from '../components/VIPVerificationForm';\nimport NFTTicketCard from '../components/NFTTicketCard';\nimport NFTTicketCardSkeleton from '../components/NFTTicketCardSkeleton';\n\n// --- Type Definitions ---\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst availableTicketMetadataCIDs = {\n  0: \"bafkreifkrvwbi3hlxcii7uwsaunx73mdcy34jjx7nitrhfgag2vudg5ujm\",\n  1: \"bafkreifpncyhhgrna7iletoaquzn2dgnesz5xvim6ygqizldimw2bud6pm\",\n  2: \"bafkreigrghfwlh3dhm4a6imin2jzkwg7qjwqza2r5dymocfjn77hyrztmi\",\n  3: \"bafkreibqxwclnkhlkjc3fvlco7tecujwdjiohayilfywxaeoqeeuazquzi\",\n  4: \"bafkreieqkoa2lp36wdljvyztz2gi33n7kcsrnfp5ybu3cs3mrgoeq5pavm\",\n  5: \"bafkreidf3ahogkojhoe57e6wlwb3prmetqeoqmfty2lymkchc2mwsuftsu\",\n  6: \"bafkreidecmmrdujzb45oe7jgf7d76ndtpmhwncimo7ez3afbiccv7342ju\"\n};\nconst preloadImage = src => {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.src = src;\n    img.onload = () => resolve();\n    img.onerror = () => reject();\n  });\n};\nconst MarketplacePage = () => {\n  _s();\n  var _networkState$current;\n  const {\n    walletAddress,\n    networkState,\n    switchNetwork\n  } = useWallet();\n  const {\n    user\n  } = useAuth();\n  const {\n    isVIP,\n    checkingVIP,\n    checkVIPStatus\n  } = useVIP();\n  const [availableTickets, setAvailableTickets] = useState([]);\n  const [ownedTickets, setOwnedTickets] = useState([]);\n  const [loadingTickets, setLoadingTickets] = useState(true);\n  const [buyingTicketId, setBuyingTicketId] = useState(null);\n  const [resellingTicketId, setResellingTicketId] = useState(null);\n  const [eventPrice, setEventPrice] = useState(null);\n  const [dataInitialized, setDataInitialized] = useState(false);\n  const lastFetchTimeRef = useRef(0);\n\n  // Preload images - moved inside the component\n  useEffect(() => {\n    const imageCIDs = [\"bafkreifn5vngr66plqezmwvfubc4snvi27krijibh7ddh3fsvo6h24n3p4\", \"bafkreigyoncf7lgpndglgipvnotywpsudwuzrsyq46blyqtyr5eirr4fxy\", \"bafkreibeacfvmoafm27zonbyfuuswvpvsfhcznfddtgomu2472qno6ndze\", \"bafybeiarmcnke3q4t5tfo765rj7keylgmcu4oipag5lnugfrp4usdopyne\", \"bafybeiez6wvn5gjta3fkzvv65oldoevxbidmgt2v7a4fioupf34mnxzxuy\", \"bafybeie2dqx7sizq7wi4nkwikvaluhokmfnmwcqsidvtt45nvxbzautt2i\", \"bafybeidiruone3wadolwzvzm4hgrkvyddqrqoy73pd7c6y2hensxjzrarq\"];\n    const preload = async () => {\n      const urls = imageCIDs.map(cid => `https://ipfs.io/ipfs/${cid}`);\n      await Promise.allSettled(urls.map(preloadImage));\n      console.log(\"All images preloaded.\");\n    };\n    preload();\n  }, []);\n\n  // Fetch price only once on mount\n  useEffect(() => {\n    const fetchPrice = async () => {\n      try {\n        const details = await getEventDetails();\n        if (details) {\n          // CORRECTED: Use the already formatted strings directly\n          setEventPrice({\n            insider: details.ticketPriceInsider,\n            outsider: details.ticketPriceOutsider\n          });\n        } else {\n          console.warn(\"Ticket price not found in event details.\");\n          toast.error(\"Could not determine event price.\");\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch event details:\", error);\n        // The error message in the toast was \"Could not load event details.\"\n        // The console error includes the specific TypeError.\n        // If the error persists after this fix, the original error is likely within getEventDetails itself.\n        toast.error(`Failed to load event details. Check console for specifics.`);\n      }\n    };\n    fetchPrice();\n  }, []); // Empty dependency array means this runs once on component mount\n\n  // Fetch owned tickets with rate limiting\n  const fetchOwnedTickets = useCallback(async (force = false) => {\n    if (!walletAddress) return;\n    const now = Date.now();\n    if (!force && now - lastFetchTimeRef.current < 3000) {\n      console.log(\"Skipping fetch due to rate limit\");\n      return;\n    }\n    console.log(\"Starting fetchOwnedTickets for address:\", walletAddress);\n    setLoadingTickets(true);\n    lastFetchTimeRef.current = now;\n    try {\n      console.log(\"Calling getMyTicketsUtil...\");\n      const ownedIds = await getMyTicketsUtil(walletAddress);\n      console.log(\"Raw owned ticket IDs returned:\", ownedIds);\n      if (!ownedIds || ownedIds.length === 0) {\n        console.log(\"No owned tickets found, clearing owned tickets state\");\n        setOwnedTickets([]);\n        return;\n      }\n      const ticketsData = ownedIds.map(id => {\n        const eventNames = ['Cosmic Rhythm', 'Stellar Fest', 'Echo Vibe', 'Midnight Beats'];\n        const eventName = eventNames[id % eventNames.length];\n        const seatNumber = `Seat-${id}`;\n        const cid = availableTicketMetadataCIDs[id]; // This might need adjustment based on actual ID scheme\n        const imageUrl = cid ? `https://ipfs.io/ipfs/${cid}` : undefined;\n        const price = eventPrice ? eventPrice.outsider : '0.001'; // Default or fallback price\n        return {\n          id,\n          eventName,\n          price,\n          seatNumber,\n          qrValue: `qr-${id}-${Date.now()}`,\n          imageUrl\n        };\n      });\n      console.log(\"Setting owned tickets:\", ticketsData);\n      setOwnedTickets(ticketsData);\n      setDataInitialized(true);\n    } catch (error) {\n      console.error(\"Failed to fetch owned tickets:\", error);\n      toast.error(\"Could not load your owned tickets. Please try again.\");\n    } finally {\n      setLoadingTickets(false);\n    }\n  }, [walletAddress, eventPrice]); // Added eventPrice as a dependency if it's used to determine display price of owned tickets\n\n  // Initial fetch and periodic refresh\n  useEffect(() => {\n    if (walletAddress) {\n      fetchOwnedTickets(true);\n      const refreshInterval = setInterval(() => {\n        console.log(\"Periodic refresh of owned tickets\");\n        fetchOwnedTickets(false);\n      }, 10000);\n      return () => clearInterval(refreshInterval);\n    }\n  }, [walletAddress, fetchOwnedTickets]);\n\n  // Fetch available tickets when dependencies change\n  useEffect(() => {\n    const fetchAvailable = async () => {\n      if (!walletAddress || !eventPrice) return;\n      try {\n        setLoadingTickets(true);\n        console.log(\"Fetching available tickets...\");\n        const availableTicketsData = Object.entries(availableTicketMetadataCIDs).map(([id, cid]) => ({\n          id: parseInt(id),\n          cid: cid\n        }));\n        console.log(\"Processing available tickets:\", availableTicketsData);\n        const availableDetailsPromises = availableTicketsData.map(async ({\n          id,\n          cid\n        }) => {\n          try {\n            var _metadata$attributes, _metadata$attributes$, _metadata$image;\n            const uri = `ipfs://${cid}`;\n            console.log(`Workspaceing metadata for ticket ${id} from ${uri}`);\n            const metadata = await fetchMetadataFromUri(uri);\n            if (!metadata) {\n              console.error(`Failed to fetch metadata for ticket ${id} with CID ${cid}`);\n              return null;\n            }\n            const price = isVIP ? eventPrice.insider : eventPrice.outsider;\n            const ticketData = {\n              id,\n              eventName: (metadata === null || metadata === void 0 ? void 0 : metadata.name) || `Ticket ${id}`,\n              price,\n              seatNumber: (metadata === null || metadata === void 0 ? void 0 : (_metadata$attributes = metadata.attributes) === null || _metadata$attributes === void 0 ? void 0 : (_metadata$attributes$ = _metadata$attributes.find(attr => attr.trait_type === 'Seat')) === null || _metadata$attributes$ === void 0 ? void 0 : _metadata$attributes$.value) || `Seat-${id}`,\n              qrValue: `qr-${id}`,\n              imageUrl: (metadata === null || metadata === void 0 ? void 0 : (_metadata$image = metadata.image) === null || _metadata$image === void 0 ? void 0 : _metadata$image.replace(/^ipfs:\\/\\//, 'https://ipfs.io/ipfs/')) || undefined,\n              metadata\n            };\n            console.log(`Processed ticket ${id}:`, ticketData);\n            return ticketData;\n          } catch (detailError) {\n            console.error(`Failed to fetch details for available token ${id}:`, detailError);\n            return null;\n          }\n        });\n        const resolvedDetails = (await Promise.all(availableDetailsPromises)).filter(Boolean);\n        console.log(\"Final available tickets:\", resolvedDetails);\n        setAvailableTickets(resolvedDetails);\n      } catch (error) {\n        console.error(\"Failed to fetch available tickets:\", error);\n        toast.error(\"Could not load available tickets. Please try again.\");\n      } finally {\n        setLoadingTickets(false);\n      }\n    };\n    fetchAvailable();\n  }, [walletAddress, eventPrice, isVIP]); // Added isVIP\n\n  const handleVIPVerification = async (name, rollNumber) => {\n    try {\n      await checkVIPStatus(name, rollNumber);\n    } catch (error) {\n      console.error(\"VIP verification failed:\", error);\n    }\n  };\n  useEffect(() => {\n    if (user && !isVIP && !checkingVIP) {\n      toast.error('VIP verification required. Please verify your VIP status first.');\n    }\n  }, [user, isVIP, checkingVIP]);\n  const handleVIPVerified = useCallback(() => {\n    console.log(\"VIP verified, data will refresh automatically through effects\");\n    // Data refresh is handled by useEffects that depend on `isVIP` or `eventPrice`\n    // If `isVIP` status directly changes `eventPrice` or how tickets are displayed,\n    // the existing `useEffect` for available tickets should re-run.\n    // You might also want to force a refresh of available tickets if their price depends on VIP status\n    // and that price is determined/formatted within `WorkspaceAvailable`.\n  }, []);\n  useEffect(() => {\n    const initializeData = async () => {\n      if (walletAddress && !dataInitialized) {\n        console.log(\"Initializing marketplace data...\");\n        setLoadingTickets(true);\n        try {\n          // Fetch price first if not already fetched, though the dedicated effect should handle it\n          if (!eventPrice) {\n            const details = await getEventDetails();\n            if (details) {\n              setEventPrice({\n                insider: details.ticketPriceInsider,\n                outsider: details.ticketPriceOutsider\n              });\n            }\n          }\n          await fetchOwnedTickets(true); // force fetch\n          setDataInitialized(true);\n        } catch (error) {\n          console.error(\"Error during initial data load:\", error);\n        } finally {\n          setLoadingTickets(false);\n        }\n      }\n    };\n    initializeData();\n  }, [walletAddress, dataInitialized, fetchOwnedTickets, eventPrice]);\n  const handleBuyTicket = async ticketId => {\n    if (!walletAddress || !user) return toast.error('Connect wallet and log in first.');\n    if (!(networkState !== null && networkState !== void 0 && networkState.isCorrect)) {\n      toast.error('Incorrect network. Please switch.');\n      await switchNetwork();\n      return;\n    }\n    if (isVIP === null && process.env.REACT_APP_VIP_REQUIRED === 'true') return toast.error('Please complete VIP verification.');\n    if (!eventPrice) return toast.error('Event price is not available. Please wait or refresh.');\n    const isInsider = isVIP === true;\n    const ownedTicketCount = ownedTickets.length;\n    if (isInsider && ownedTicketCount >= 1 && process.env.REACT_APP_VIP_LIMIT === 'true') {\n      return toast.error(\"VIP members are limited to 1 ticket.\");\n    }\n    setBuyingTicketId(ticketId);\n    const toastId = `buy-${ticketId}`;\n    toast.loading('Processing transaction...', {\n      id: toastId\n    });\n    try {\n      // The 'ticketId' for buying from available tickets is used for metadata lookup (URI)\n      // The actual token ID might be different if your contract mints sequentially.\n      // For this example, we'll assume ticketId from 'availableTicketMetadataCIDs' is what we need for URI.\n      // The QR hash also needs to be determined or generated.\n      // The `buyTicketUtil` expects `tokenURI` and `qrHash`.\n\n      const selectedAvailableTicket = availableTickets.find(t => t.id === ticketId);\n      if (!selectedAvailableTicket || !selectedAvailableTicket.metadata) {\n        toast.error('Ticket metadata not found.', {\n          id: toastId\n        });\n        setBuyingTicketId(null);\n        return;\n      }\n\n      // Assuming the CID used to fetch metadata is the tokenURI for minting.\n      // The key of availableTicketMetadataCIDs (which became selectedAvailableTicket.id)\n      // is used to find the CID.\n      const metadataCid = availableTicketMetadataCIDs[selectedAvailableTicket.id];\n      if (!metadataCid) {\n        toast.error('Metadata CID not found for this ticket.', {\n          id: toastId\n        });\n        setBuyingTicketId(null);\n        return;\n      }\n      const tokenURI = `ipfs://${metadataCid}`; // Or however your contract expects the URI\n      const qrHash = `qr-${selectedAvailableTicket.id}-${Date.now()}`; // Example QR Hash, make this robust\n\n      const isOutsider = !isInsider;\n      const priceToSend = isOutsider ? eventPrice.outsider : eventPrice.insider;\n      console.log('handleBuyTicket: eventPrice:', eventPrice, 'priceToSend:', priceToSend);\n      if (!priceToSend || priceToSend === '0' || parseFloat(priceToSend) === 0) {\n        toast.error('Ticket price is not available or is zero.', {\n          id: toastId\n        });\n        setBuyingTicketId(null);\n        return;\n      }\n      const txHash = await buyTicketUtil(tokenURI,\n      // This should be the metadata URI for the new token\n      qrHash,\n      // A unique hash for the QR code\n      isOutsider, priceToSend // This is already an Ether string, buyTicketUtil will parseEther\n      );\n      toast.success(/*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [\"Ticket Purchased! \", /*#__PURE__*/_jsxDEV(\"a\", {\n          href: `https://sepolia.etherscan.io/tx/${txHash}`,\n          target: \"_blank\",\n          rel: \"noopener noreferrer\",\n          className: \"underline\",\n          children: \"View Tx\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 39\n        }, this)]\n      }, void 0, true), {\n        id: toastId,\n        duration: 6000\n      });\n      await new Promise(resolve => setTimeout(resolve, 3000)); // Give time for node to see tx\n      await fetchOwnedTickets(true); // Force refresh\n      // Optionally, refresh available tickets if one was consumed\n      // This depends on how `getAvailableTicketsUtil` works; if it shows all mintable types, no change.\n      // If it shows specific unowned instance IDs, it needs update.\n      // For now, assuming `availableTicketMetadataCIDs` represents types of tickets to mint.\n    } catch (error) {\n      console.error(\"Buy Ticket Failed:\", error);\n      toast.error(`Purchase Failed: ${error.message || 'Unknown error'}`, {\n        id: toastId,\n        duration: 6000\n      });\n    } finally {\n      setBuyingTicketId(null);\n    }\n  };\n  const handleResaleTicket = async tokenId => {\n    if (!walletAddress || !user) return toast.error('Connect wallet and log in first.');\n    if (!(networkState !== null && networkState !== void 0 && networkState.isCorrect)) {\n      toast.error('Incorrect network. Please switch.');\n      await switchNetwork();\n      return;\n    }\n    setResellingTicketId(tokenId);\n    const toastId = `resell-${tokenId}`;\n    toast.loading('Processing resale...', {\n      id: toastId\n    });\n    try {\n      const txHash = await resellTicketUtil(tokenId);\n      toast.success(/*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [\"Resale Submitted! \", /*#__PURE__*/_jsxDEV(\"a\", {\n          href: `https://sepolia.etherscan.io/tx/${txHash}`,\n          target: \"_blank\",\n          rel: \"noopener noreferrer\",\n          className: \"underline\",\n          children: \"View Tx\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 387,\n          columnNumber: 39\n        }, this)]\n      }, void 0, true), {\n        id: toastId,\n        duration: 6000\n      });\n      await new Promise(resolve => setTimeout(resolve, 3000));\n      await fetchOwnedTickets(true); // Force refresh\n      // Optionally refresh available tickets if resold tickets appear there\n    } catch (error) {\n      console.error(\"Resell Failed:\", error);\n      toast.error(`Resale Failed: ${error.message || 'Unknown error'}`, {\n        id: toastId,\n        duration: 6000\n      });\n    } finally {\n      setResellingTicketId(null);\n    }\n  };\n\n  // --- Render Logic ---\n  if (!user) return /*#__PURE__*/_jsxDEV(motion.div, {\n    initial: {\n      opacity: 0\n    },\n    animate: {\n      opacity: 1\n    },\n    className: \"flex items-center justify-center min-h-[400px]\",\n    children: /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-accent-light text-lg animate-fade-in\",\n      children: \"Please log in to access the marketplace.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 404,\n    columnNumber: 9\n  }, this);\n  if (!walletAddress) return /*#__PURE__*/_jsxDEV(motion.div, {\n    initial: {\n      opacity: 0\n    },\n    animate: {\n      opacity: 1\n    },\n    className: \"flex items-center justify-center min-h-[400px]\",\n    children: /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-accent-light text-lg animate-fade-in\",\n      children: \"Please connect your wallet to access the marketplace.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 409,\n    columnNumber: 9\n  }, this);\n  if (!(networkState !== null && networkState !== void 0 && networkState.isCorrect)) return /*#__PURE__*/_jsxDEV(motion.div, {\n    initial: {\n      opacity: 0\n    },\n    animate: {\n      opacity: 1\n    },\n    className: \"flex flex-col items-center justify-center min-h-[400px] space-y-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-center text-error text-lg animate-fade-in\",\n      children: [\"Wrong Network Detected (\", (networkState === null || networkState === void 0 ? void 0 : (_networkState$current = networkState.currentNetwork) === null || _networkState$current === void 0 ? void 0 : _networkState$current.name) || 'Unknown', \").\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(GlowingButton, {\n      onClick: switchNetwork,\n      children: \"Switch Network\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 418,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 414,\n    columnNumber: 9\n  }, this);\n  if (process.env.REACT_APP_VIP_REQUIRED === 'true' && isVIP === null) {\n    return /*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        opacity: 0\n      },\n      animate: {\n        opacity: 1\n      },\n      className: \"max-w-md mx-auto my-8\",\n      children: /*#__PURE__*/_jsxDEV(VIPVerificationForm, {\n        onVerified: handleVIPVerified\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 429,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 13\n    }, this);\n  }\n  if (!isVIP && !checkingVIP) {\n    return /*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        opacity: 0\n      },\n      animate: {\n        opacity: 1\n      },\n      className: \"max-w-md mx-auto my-8\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-xl font-semibold mb-4\",\n        children: \"VIP Verification Required\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 441,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(VIPVerificationForm, {\n        onVerified: handleVIPVerification\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 442,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 436,\n      columnNumber: 13\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(motion.div, {\n    initial: {\n      opacity: 0\n    },\n    animate: {\n      opacity: 1\n    },\n    className: \"container mx-auto px-4 py-8 space-y-12\",\n    children: [/*#__PURE__*/_jsxDEV(\"section\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-2xl font-bold text-accent-light mb-6\",\n        children: \"My Tickets\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 451,\n        columnNumber: 17\n      }, this), loadingTickets && ownedTickets.length === 0 ?\n      /*#__PURE__*/\n      // Show skeleton only if loading AND no tickets yet\n      _jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",\n        children: [...Array(2)].map((_, index) => /*#__PURE__*/_jsxDEV(NFTTicketCardSkeleton, {}, `owned-skeleton-${index}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 58\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 453,\n        columnNumber: 21\n      }, this) : ownedTickets.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",\n        children: ownedTickets.map(ticket => /*#__PURE__*/_jsxDEV(NFTTicketCard, {\n          ticket: ticket,\n          onBuy: () => {},\n          isOwned: true,\n          onResell: handleResaleTicket,\n          isReselling: resellingTicketId === ticket.id\n        }, `owned-${ticket.id}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 459,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 457,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-secondary-dark p-6 rounded-lg text-center\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-text-secondary\",\n          children: \"You don't own any tickets yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 471,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 470,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 450,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-2xl font-bold text-accent-light mb-6\",\n        children: \"Available Tickets\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 17\n      }, this), loadingTickets && availableTickets.length === 0 ?\n      /*#__PURE__*/\n      // Show skeleton only if loading AND no tickets yet\n      _jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",\n        children: [...Array(4)].map((_, index) => /*#__PURE__*/_jsxDEV(NFTTicketCardSkeleton, {}, `available-skeleton-${index}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 481,\n          columnNumber: 58\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 21\n      }, this) : availableTickets.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",\n        children: availableTickets.map(ticket => /*#__PURE__*/_jsxDEV(NFTTicketCard, {\n          ticket: ticket,\n          onBuy: handleBuyTicket,\n          isOwned: false,\n          isBuying: buyingTicketId === ticket.id\n        }, `available-${ticket.id}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 486,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center text-text-secondary bg-secondary-dark p-6 rounded-lg\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"No tickets currently available for purchase.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 497,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 496,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 477,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 448,\n    columnNumber: 9\n  }, this);\n};\n_s(MarketplacePage, \"SKFuIQi0MVeIa1TggoGruvqEWoo=\", false, function () {\n  return [useWallet, useAuth, useVIP];\n});\n_c = MarketplacePage;\nexport default MarketplacePage;\nvar _c;\n$RefreshReg$(_c, \"MarketplacePage\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","toast","motion","useAuth","useWallet","useVIP","buyTicket","buyTicketUtil","getMyTickets","getMyTicketsUtil","resellTicket","resellTicketUtil","getEventDetails","fetchMetadataFromUri","GlowingButton","VIPVerificationForm","NFTTicketCard","NFTTicketCardSkeleton","jsxDEV","_jsxDEV","Fragment","_Fragment","availableTicketMetadataCIDs","preloadImage","src","Promise","resolve","reject","img","Image","onload","onerror","MarketplacePage","_s","_networkState$current","walletAddress","networkState","switchNetwork","user","isVIP","checkingVIP","checkVIPStatus","availableTickets","setAvailableTickets","ownedTickets","setOwnedTickets","loadingTickets","setLoadingTickets","buyingTicketId","setBuyingTicketId","resellingTicketId","setResellingTicketId","eventPrice","setEventPrice","dataInitialized","setDataInitialized","lastFetchTimeRef","imageCIDs","preload","urls","map","cid","allSettled","console","log","fetchPrice","details","insider","ticketPriceInsider","outsider","ticketPriceOutsider","warn","error","fetchOwnedTickets","force","now","Date","current","ownedIds","length","ticketsData","id","eventNames","eventName","seatNumber","imageUrl","undefined","price","qrValue","refreshInterval","setInterval","clearInterval","fetchAvailable","availableTicketsData","Object","entries","parseInt","availableDetailsPromises","_metadata$attributes","_metadata$attributes$","_metadata$image","uri","metadata","ticketData","name","attributes","find","attr","trait_type","value","image","replace","detailError","resolvedDetails","all","filter","Boolean","handleVIPVerification","rollNumber","handleVIPVerified","initializeData","handleBuyTicket","ticketId","isCorrect","process","env","REACT_APP_VIP_REQUIRED","isInsider","ownedTicketCount","REACT_APP_VIP_LIMIT","toastId","loading","selectedAvailableTicket","t","metadataCid","tokenURI","qrHash","isOutsider","priceToSend","parseFloat","txHash","success","children","href","target","rel","className","fileName","_jsxFileName","lineNumber","columnNumber","duration","setTimeout","message","handleResaleTicket","tokenId","div","initial","opacity","animate","currentNetwork","onClick","onVerified","Array","_","index","ticket","onBuy","isOwned","onResell","isReselling","isBuying","_c","$RefreshReg$"],"sources":["C:/Users/negis/OneDrive/Desktop/new project/blockfest-ui/src/pages/MarketplacePage.tsx"],"sourcesContent":["// src/pages/MarketplacePage.tsx\n\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { toast } from 'react-hot-toast';\nimport { motion } from 'framer-motion';\n// Import specific utilities from ethers\nimport { formatEther, parseEther } from 'ethers'; // formatEther is used by blockchain.ts, parseEther for sending tx\n\n// --- Context Hooks ---\nimport { useAuth, useWallet } from '../contexts/AuthContext';\nimport { useVIP } from '../contexts/VIPContext';\n\n// --- Blockchain Utilities ---\nimport {\n    buyTicket as buyTicketUtil,\n    getMyTickets as getMyTicketsUtil,\n    resellTicket as resellTicketUtil,\n    getEventDetails,\n    getTokenMetadataURI,\n    getAvailableTickets as getAvailableTicketsUtil\n} from '../utils/blockchain';\nimport fetchMetadataFromUri from '../utils/metadata';\n\n// --- Components ---\nimport GlowingButton from '../components/GlowingButton';\nimport VIPVerificationForm from '../components/VIPVerificationForm';\nimport NFTTicketCard from '../components/NFTTicketCard';\nimport NFTTicketCardSkeleton from '../components/NFTTicketCardSkeleton';\n\n// --- Type Definitions ---\ninterface TicketData {\n    id: number;\n    eventName: string;\n    price: string; // Price stored as formatted string (e.g., \"0.05\")\n    seatNumber: string;\n    qrValue: string;\n    imageUrl?: string;\n    metadata?: any;\n}\nconst availableTicketMetadataCIDs: { [key: number]: string } = {\n    0: \"bafkreifkrvwbi3hlxcii7uwsaunx73mdcy34jjx7nitrhfgag2vudg5ujm\",\n    1: \"bafkreifpncyhhgrna7iletoaquzn2dgnesz5xvim6ygqizldimw2bud6pm\",\n    2: \"bafkreigrghfwlh3dhm4a6imin2jzkwg7qjwqza2r5dymocfjn77hyrztmi\",\n    3: \"bafkreibqxwclnkhlkjc3fvlco7tecujwdjiohayilfywxaeoqeeuazquzi\",\n    4: \"bafkreieqkoa2lp36wdljvyztz2gi33n7kcsrnfp5ybu3cs3mrgoeq5pavm\",\n    5: \"bafkreidf3ahogkojhoe57e6wlwb3prmetqeoqmfty2lymkchc2mwsuftsu\",\n    6: \"bafkreidecmmrdujzb45oe7jgf7d76ndtpmhwncimo7ez3afbiccv7342ju\",\n};\n\nconst preloadImage = (src: string): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.src = src;\n    img.onload = () => resolve();\n    img.onerror = () => reject();\n  });\n};\n\nconst MarketplacePage: React.FC = () => {\n    const { walletAddress, networkState, switchNetwork } = useWallet();\n    const { user } = useAuth();\n    const { isVIP, checkingVIP, checkVIPStatus } = useVIP();\n    const [availableTickets, setAvailableTickets] = useState<TicketData[]>([]);\n    const [ownedTickets, setOwnedTickets] = useState<TicketData[]>([]);\n    const [loadingTickets, setLoadingTickets] = useState<boolean>(true);\n    const [buyingTicketId, setBuyingTicketId] = useState<string | number | null>(null);\n    const [resellingTicketId, setResellingTicketId] = useState<number | null>(null);\n    const [eventPrice, setEventPrice] = useState<{ insider: string; outsider: string } | null>(null);\n    const [dataInitialized, setDataInitialized] = useState<boolean>(false);\n    const lastFetchTimeRef = useRef<number>(0);\n\n    // Preload images - moved inside the component\n    useEffect(() => {\n      const imageCIDs = [\n        \"bafkreifn5vngr66plqezmwvfubc4snvi27krijibh7ddh3fsvo6h24n3p4\",\n        \"bafkreigyoncf7lgpndglgipvnotywpsudwuzrsyq46blyqtyr5eirr4fxy\",\n        \"bafkreibeacfvmoafm27zonbyfuuswvpvsfhcznfddtgomu2472qno6ndze\",\n        \"bafybeiarmcnke3q4t5tfo765rj7keylgmcu4oipag5lnugfrp4usdopyne\",\n        \"bafybeiez6wvn5gjta3fkzvv65oldoevxbidmgt2v7a4fioupf34mnxzxuy\",\n        \"bafybeie2dqx7sizq7wi4nkwikvaluhokmfnmwcqsidvtt45nvxbzautt2i\",\n        \"bafybeidiruone3wadolwzvzm4hgrkvyddqrqoy73pd7c6y2hensxjzrarq\",\n      ];\n    \n      const preload = async () => {\n        const urls = imageCIDs.map(cid => `https://ipfs.io/ipfs/${cid}`);\n        await Promise.allSettled(urls.map(preloadImage));\n        console.log(\"All images preloaded.\");\n      };\n    \n      preload();\n    }, []);\n\n    // Fetch price only once on mount\n    useEffect(() => {\n        const fetchPrice = async () => {\n            try {\n                const details = await getEventDetails();\n                if (details) {\n                    // CORRECTED: Use the already formatted strings directly\n                    setEventPrice({\n                        insider: details.ticketPriceInsider,\n                        outsider: details.ticketPriceOutsider\n                    });\n                } else {\n                    console.warn(\"Ticket price not found in event details.\");\n                    toast.error(\"Could not determine event price.\");\n                }\n            } catch (error) {\n                console.error(\"Failed to fetch event details:\", error);\n                // The error message in the toast was \"Could not load event details.\"\n                // The console error includes the specific TypeError.\n                // If the error persists after this fix, the original error is likely within getEventDetails itself.\n                toast.error(`Failed to load event details. Check console for specifics.`);\n            }\n        };\n        fetchPrice();\n    }, []); // Empty dependency array means this runs once on component mount\n\n    // Fetch owned tickets with rate limiting\n    const fetchOwnedTickets = useCallback(async (force: boolean = false) => {\n        if (!walletAddress) return;\n        \n        const now = Date.now();\n        if (!force && now - lastFetchTimeRef.current < 3000) {\n            console.log(\"Skipping fetch due to rate limit\");\n            return;\n        }\n        \n        console.log(\"Starting fetchOwnedTickets for address:\", walletAddress);\n        setLoadingTickets(true);\n        lastFetchTimeRef.current = now;\n        \n        try {\n            console.log(\"Calling getMyTicketsUtil...\");\n            const ownedIds = await getMyTicketsUtil(walletAddress);\n            console.log(\"Raw owned ticket IDs returned:\", ownedIds);\n            \n            if (!ownedIds || ownedIds.length === 0) {\n                console.log(\"No owned tickets found, clearing owned tickets state\");\n                setOwnedTickets([]);\n                return;\n            }\n\n            const ticketsData = ownedIds.map((id: number) => {\n                const eventNames = ['Cosmic Rhythm', 'Stellar Fest', 'Echo Vibe', 'Midnight Beats'];\n                const eventName = eventNames[id % eventNames.length];\n                const seatNumber = `Seat-${id}`;\n                const cid = availableTicketMetadataCIDs[id]; // This might need adjustment based on actual ID scheme\n                const imageUrl = cid ? `https://ipfs.io/ipfs/${cid}` : undefined;\n                const price = eventPrice ? eventPrice.outsider : '0.001'; // Default or fallback price\n                return {\n                    id,\n                    eventName,\n                    price,\n                    seatNumber,\n                    qrValue: `qr-${id}-${Date.now()}`,\n                    imageUrl\n                };\n            });\n\n            console.log(\"Setting owned tickets:\", ticketsData);\n            setOwnedTickets(ticketsData);\n            setDataInitialized(true);\n        } catch (error) {\n            console.error(\"Failed to fetch owned tickets:\", error);\n            toast.error(\"Could not load your owned tickets. Please try again.\");\n        } finally {\n            setLoadingTickets(false);\n        }\n    }, [walletAddress, eventPrice]); // Added eventPrice as a dependency if it's used to determine display price of owned tickets\n\n    // Initial fetch and periodic refresh\n    useEffect(() => {\n        if (walletAddress) {\n            fetchOwnedTickets(true);\n            const refreshInterval = setInterval(() => {\n                console.log(\"Periodic refresh of owned tickets\");\n                fetchOwnedTickets(false);\n            }, 10000); \n            return () => clearInterval(refreshInterval);\n        }\n    }, [walletAddress, fetchOwnedTickets]);\n\n    // Fetch available tickets when dependencies change\n    useEffect(() => {\n        const fetchAvailable = async () => {\n            if (!walletAddress || !eventPrice) return; \n            \n            try {\n                setLoadingTickets(true);\n                console.log(\"Fetching available tickets...\");\n                \n                const availableTicketsData = Object.entries(availableTicketMetadataCIDs).map(([id, cid]) => ({\n                    id: parseInt(id),\n                    cid: cid\n                }));\n\n                console.log(\"Processing available tickets:\", availableTicketsData);\n\n                const availableDetailsPromises = availableTicketsData.map(async ({ id, cid }) => {\n                    try {\n                        const uri = `ipfs://${cid}`;\n                        console.log(`Workspaceing metadata for ticket ${id} from ${uri}`);\n                        const metadata = await fetchMetadataFromUri(uri);\n                        \n                        if (!metadata) {\n                            console.error(`Failed to fetch metadata for ticket ${id} with CID ${cid}`);\n                            return null;\n                        }\n                        const price = isVIP ? (eventPrice.insider) : (eventPrice.outsider);\n                        const ticketData = {\n                            id,\n                            eventName: metadata?.name || `Ticket ${id}`,\n                            price,\n                            seatNumber: metadata?.attributes?.find((attr: any) => attr.trait_type === 'Seat')?.value || `Seat-${id}`,\n                            qrValue: `qr-${id}`,\n                            imageUrl: metadata?.image?.replace(/^ipfs:\\/\\//, 'https://ipfs.io/ipfs/') || undefined,\n                            metadata\n                        };\n                        console.log(`Processed ticket ${id}:`, ticketData);\n                        return ticketData;\n                    } catch (detailError) {\n                        console.error(`Failed to fetch details for available token ${id}:`, detailError);\n                        return null;\n                    }\n                });\n\n                const resolvedDetails = (await Promise.all(availableDetailsPromises)).filter(Boolean) as TicketData[];\n                console.log(\"Final available tickets:\", resolvedDetails);\n                setAvailableTickets(resolvedDetails);\n                \n            } catch (error) {\n                console.error(\"Failed to fetch available tickets:\", error);\n                toast.error(\"Could not load available tickets. Please try again.\");\n            } finally {\n                setLoadingTickets(false);\n            }\n        };\n\n        fetchAvailable();\n    }, [walletAddress, eventPrice, isVIP]); // Added isVIP\n\n    const handleVIPVerification = async (name: string, rollNumber: string) => {\n        try {\n            await checkVIPStatus(name, rollNumber);\n        } catch (error) {\n            console.error(\"VIP verification failed:\", error);\n        }\n    };\n\n    useEffect(() => {\n        if (user && !isVIP && !checkingVIP) {\n            toast.error('VIP verification required. Please verify your VIP status first.');\n        }\n    }, [user, isVIP, checkingVIP]);\n\n    const handleVIPVerified = useCallback(() => {\n        console.log(\"VIP verified, data will refresh automatically through effects\");\n        // Data refresh is handled by useEffects that depend on `isVIP` or `eventPrice`\n        // If `isVIP` status directly changes `eventPrice` or how tickets are displayed,\n        // the existing `useEffect` for available tickets should re-run.\n        // You might also want to force a refresh of available tickets if their price depends on VIP status\n        // and that price is determined/formatted within `WorkspaceAvailable`.\n    }, []);\n\n    useEffect(() => {\n        const initializeData = async () => {\n            if (walletAddress && !dataInitialized) {\n                console.log(\"Initializing marketplace data...\");\n                setLoadingTickets(true);\n                try {\n                    // Fetch price first if not already fetched, though the dedicated effect should handle it\n                    if (!eventPrice) {\n                         const details = await getEventDetails();\n                         if (details) {\n                            setEventPrice({\n                                insider: details.ticketPriceInsider,\n                                outsider: details.ticketPriceOutsider\n                            });\n                         }\n                    }\n                    await fetchOwnedTickets(true); // force fetch\n                    setDataInitialized(true);\n                } catch (error) {\n                     console.error(\"Error during initial data load:\", error);\n                } finally {\n                    setLoadingTickets(false);\n                }\n            }\n        };\n\n        initializeData();\n    }, [walletAddress, dataInitialized, fetchOwnedTickets, eventPrice]);\n\n\n    const handleBuyTicket = async (ticketId: string | number) => {\n        if (!walletAddress || !user) return toast.error('Connect wallet and log in first.');\n        if (!networkState?.isCorrect) { toast.error('Incorrect network. Please switch.'); await switchNetwork(); return; }\n        if (isVIP === null && process.env.REACT_APP_VIP_REQUIRED === 'true') return toast.error('Please complete VIP verification.');\n        if (!eventPrice) return toast.error('Event price is not available. Please wait or refresh.');\n\n        const isInsider = isVIP === true;\n        const ownedTicketCount = ownedTickets.length;\n        if (isInsider && ownedTicketCount >= 1 && process.env.REACT_APP_VIP_LIMIT === 'true') {\n            return toast.error(\"VIP members are limited to 1 ticket.\");\n        }\n\n        setBuyingTicketId(ticketId);\n        const toastId = `buy-${ticketId}`;\n        toast.loading('Processing transaction...', { id: toastId });\n\n        try {\n            // The 'ticketId' for buying from available tickets is used for metadata lookup (URI)\n            // The actual token ID might be different if your contract mints sequentially.\n            // For this example, we'll assume ticketId from 'availableTicketMetadataCIDs' is what we need for URI.\n            // The QR hash also needs to be determined or generated.\n            // The `buyTicketUtil` expects `tokenURI` and `qrHash`.\n            \n            const selectedAvailableTicket = availableTickets.find(t => t.id === ticketId);\n            if (!selectedAvailableTicket || !selectedAvailableTicket.metadata) {\n                toast.error('Ticket metadata not found.', { id: toastId });\n                setBuyingTicketId(null);\n                return;\n            }\n            \n            // Assuming the CID used to fetch metadata is the tokenURI for minting.\n            // The key of availableTicketMetadataCIDs (which became selectedAvailableTicket.id)\n            // is used to find the CID.\n            const metadataCid = availableTicketMetadataCIDs[selectedAvailableTicket.id];\n            if (!metadataCid) {\n                 toast.error('Metadata CID not found for this ticket.', {id: toastId});\n                 setBuyingTicketId(null);\n                 return;\n            }\n            const tokenURI = `ipfs://${metadataCid}`; // Or however your contract expects the URI\n            const qrHash = `qr-${selectedAvailableTicket.id}-${Date.now()}`; // Example QR Hash, make this robust\n\n            const isOutsider = !isInsider;\n            const priceToSend = isOutsider ? eventPrice.outsider : eventPrice.insider;\n            console.log('handleBuyTicket: eventPrice:', eventPrice, 'priceToSend:', priceToSend);\n            if (!priceToSend || priceToSend === '0' || parseFloat(priceToSend) === 0) {\n                toast.error('Ticket price is not available or is zero.', { id: toastId });\n                setBuyingTicketId(null);\n                return;\n            }\n\n            const txHash = await buyTicketUtil(\n                tokenURI,       // This should be the metadata URI for the new token\n                qrHash,         // A unique hash for the QR code\n                isOutsider,\n                priceToSend     // This is already an Ether string, buyTicketUtil will parseEther\n            );\n\n            toast.success(\n                <>\n                    Ticket Purchased! <a href={`https://sepolia.etherscan.io/tx/${txHash}`} target=\"_blank\" rel=\"noopener noreferrer\" className='underline'>View Tx</a>\n                </>,\n                { id: toastId, duration: 6000 }\n            );\n\n            await new Promise(resolve => setTimeout(resolve, 3000)); // Give time for node to see tx\n            await fetchOwnedTickets(true); // Force refresh\n            // Optionally, refresh available tickets if one was consumed\n            // This depends on how `getAvailableTicketsUtil` works; if it shows all mintable types, no change.\n            // If it shows specific unowned instance IDs, it needs update.\n            // For now, assuming `availableTicketMetadataCIDs` represents types of tickets to mint.\n\n        } catch (error: any) {\n            console.error(\"Buy Ticket Failed:\", error);\n            toast.error(`Purchase Failed: ${error.message || 'Unknown error'}`, { id: toastId, duration: 6000 });\n        } finally {\n            setBuyingTicketId(null);\n        }\n    };\n\n    const handleResaleTicket = async (tokenId: number) => {\n        if (!walletAddress || !user) return toast.error('Connect wallet and log in first.');\n        if (!networkState?.isCorrect) { toast.error('Incorrect network. Please switch.'); await switchNetwork(); return; }\n\n        setResellingTicketId(tokenId);\n        const toastId = `resell-${tokenId}`;\n        toast.loading('Processing resale...', { id: toastId });\n        try {\n            const txHash = await resellTicketUtil(tokenId);\n            toast.success(\n                <>\n                    Resale Submitted! <a href={`https://sepolia.etherscan.io/tx/${txHash}`} target=\"_blank\" rel=\"noopener noreferrer\" className='underline'>View Tx</a>\n                </>,\n                { id: toastId, duration: 6000 }\n            );\n            await new Promise(resolve => setTimeout(resolve, 3000));\n            await fetchOwnedTickets(true); // Force refresh\n            // Optionally refresh available tickets if resold tickets appear there\n        } catch (error: any) {\n            console.error(\"Resell Failed:\", error);\n            toast.error(`Resale Failed: ${error.message || 'Unknown error'}`, { id: toastId, duration: 6000 });\n        } finally {\n            setResellingTicketId(null);\n        }\n    };\n\n    // --- Render Logic ---\n    if (!user) return (\n        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className=\"flex items-center justify-center min-h-[400px]\">\n            <p className=\"text-center text-accent-light text-lg animate-fade-in\">Please log in to access the marketplace.</p>\n        </motion.div>\n    );\n    if (!walletAddress) return (\n        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className=\"flex items-center justify-center min-h-[400px]\">\n            <p className=\"text-center text-accent-light text-lg animate-fade-in\">Please connect your wallet to access the marketplace.</p>\n        </motion.div>\n    );\n    if (!networkState?.isCorrect) return (\n        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className=\"flex flex-col items-center justify-center min-h-[400px] space-y-4\">\n            <p className=\"text-center text-error text-lg animate-fade-in\">\n                Wrong Network Detected ({networkState?.currentNetwork?.name || 'Unknown'}).\n            </p>\n            <GlowingButton onClick={switchNetwork}>Switch Network</GlowingButton>\n        </motion.div>\n    );\n\n    if (process.env.REACT_APP_VIP_REQUIRED === 'true' && isVIP === null) {\n        return (\n            <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                className=\"max-w-md mx-auto my-8\"\n            >\n                <VIPVerificationForm onVerified={handleVIPVerified} />\n            </motion.div>\n        );\n    }\n\n    if (!isVIP && !checkingVIP) {\n        return (\n            <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                className=\"max-w-md mx-auto my-8\"\n            >\n                <h2 className=\"text-xl font-semibold mb-4\">VIP Verification Required</h2>\n                <VIPVerificationForm onVerified={handleVIPVerification} />\n            </motion.div>\n        );\n    }\n\n    return (\n        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className=\"container mx-auto px-4 py-8 space-y-12\">\n            {/* My Tickets Section */}\n            <section>\n                <h2 className=\"text-2xl font-bold text-accent-light mb-6\">My Tickets</h2>\n                {loadingTickets && ownedTickets.length === 0 ? ( // Show skeleton only if loading AND no tickets yet\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                        {[...Array(2)].map((_, index) => <NFTTicketCardSkeleton key={`owned-skeleton-${index}`} />)}\n                    </div>\n                ) : ownedTickets.length > 0 ? (\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                        {ownedTickets.map((ticket) => (\n                            <NFTTicketCard\n                                key={`owned-${ticket.id}`}\n                                ticket={ticket}\n                                onBuy={() => {}} \n                                isOwned={true}\n                                onResell={handleResaleTicket}\n                                isReselling={resellingTicketId === ticket.id}\n                            />\n                        ))}\n                    </div>\n                ) : (\n                    <div className=\"bg-secondary-dark p-6 rounded-lg text-center\">\n                        <p className=\"text-text-secondary\">You don't own any tickets yet.</p>\n                    </div>\n                )}\n            </section>\n\n            {/* Available Tickets Section */}\n            <section>\n                <h2 className=\"text-2xl font-bold text-accent-light mb-6\">Available Tickets</h2>\n                {loadingTickets && availableTickets.length === 0 ? ( // Show skeleton only if loading AND no tickets yet\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                        {[...Array(4)].map((_, index) => <NFTTicketCardSkeleton key={`available-skeleton-${index}`} />)}\n                    </div>\n                ) : availableTickets.length > 0 ? (\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                        {availableTickets.map((ticket) => (\n                            <NFTTicketCard\n                                key={`available-${ticket.id}`}\n                                ticket={ticket}\n                                onBuy={handleBuyTicket}\n                                isOwned={false}\n                                isBuying={buyingTicketId === ticket.id}\n                            />\n                        ))}\n                    </div>\n                ) : (\n                    <div className=\"text-center text-text-secondary bg-secondary-dark p-6 rounded-lg\">\n                        <p>No tickets currently available for purchase.</p>\n                    </div>\n                )}\n            </section>\n        </motion.div>\n    );\n};\n\nexport default MarketplacePage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}