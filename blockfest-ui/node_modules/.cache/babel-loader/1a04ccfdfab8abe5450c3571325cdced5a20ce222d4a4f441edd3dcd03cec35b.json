{"ast":null,"code":"var _s = $RefreshSig$();\n// src/firebase/auth.ts\nimport { signInWithPopup, GoogleAuthProvider, FacebookAuthProvider, signOut, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, getIdTokenResult } from \"firebase/auth\";\nimport { authClient } from \"./config\"; // Use the configured client auth instance\nimport { useState, useEffect, createContext } from 'react';\nconst googleProvider = new GoogleAuthProvider();\nconst facebookProvider = new FacebookAuthProvider();\n\n// Define the auth context type\n\n// Export the auth context\nexport const AuthContext = /*#__PURE__*/createContext(undefined);\n\n// --- Get ID Token (for Backend Auth) ---\nexport const getCurrentUserIdToken = async () => {\n  try {\n    // First try to get the current user\n    const user = authClient.currentUser;\n    if (!user) {\n      console.log('No user is currently logged in');\n      return null;\n    }\n\n    // Try to get the ID token\n    const token = await user.getIdToken();\n    if (!token) {\n      console.log('No ID token obtained');\n      return null;\n    }\n    console.log('Successfully obtained Firebase token:', token.substring(0, 20) + '...');\n    return token;\n  } catch (error) {\n    console.error('Error getting Firebase token:', {\n      error,\n      message: error.message,\n      code: error.code\n    });\n    return null;\n  }\n};\n\n// --- Auth State Management ---\nexport const useAuth = () => {\n  _s();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(authClient, async authUser => {\n      setUser(authUser);\n      setLoading(false);\n      if (authUser) {\n        try {\n          // Try to get the ID token immediately\n          await authUser.getIdToken();\n          console.log('Successfully verified user token');\n        } catch (error) {\n          console.error('Error verifying user token:', error);\n        }\n      }\n    });\n    return () => unsubscribe();\n  }, []);\n  return {\n    user,\n    loading\n  };\n};\n\n// --- Sign-in Functions ---\n_s(useAuth, \"NiO5z6JIqzX62LS5UWDgIqbZYyY=\");\nexport const signInWithGoogle = async () => {\n  try {\n    const result = await signInWithPopup(authClient, googleProvider);\n    return result.user;\n  } catch (error) {\n    console.error(\"Google Sign-in Error:\", error);\n    throw new Error(error.message || \"Google Sign-in failed.\");\n  }\n};\nexport const signInWithFacebook = async () => {\n  try {\n    const result = await signInWithPopup(authClient, facebookProvider);\n    return result.user;\n  } catch (error) {\n    console.error(\"Facebook Sign-in Error:\", error);\n    throw new Error(error.message || \"Facebook Sign-in failed.\");\n  }\n};\nexport const signInWithEmail = async (email, password) => {\n  try {\n    const userCredential = await signInWithEmailAndPassword(authClient, email, password);\n    return userCredential.user;\n  } catch (error) {\n    console.error(\"Email Sign-in Error:\", error);\n    throw new Error(error.message || \"Email Sign-in failed.\");\n  }\n};\nexport const registerWithEmail = async (email, password) => {\n  try {\n    const userCredential = await createUserWithEmailAndPassword(authClient, email, password);\n    // Optionally send verification email here: await sendEmailVerification(userCredential.user);\n    return userCredential.user;\n  } catch (error) {\n    console.error(\"Email Registration Error:\", error);\n    // Handle errors like email already in use, weak password\n    throw new Error(error.message || \"Email Registration failed.\");\n  }\n};\nexport const signOutUser = async () => {\n  try {\n    await signOut(authClient);\n  } catch (error) {\n    console.error(\"Sign-out Error:\", error);\n    throw new Error(error.message || \"Sign-out failed.\");\n  }\n};\n\n// --- Auth State Listener ---\n\nexport const listenToAuthChanges = callback => {\n  // Returns the unsubscribe function\n  return onAuthStateChanged(authClient, callback);\n};\n\n// --- Check Admin Claim ---\nexport const checkAdminStatus = async () => {\n  if (!authClient.currentUser) {\n    return false;\n  }\n  try {\n    const idTokenResult = await getIdTokenResult(authClient.currentUser);\n    return idTokenResult.claims.admin === true;\n  } catch (error) {\n    console.error(\"Error getting ID token result/claims:\", error);\n    return false;\n  }\n};","map":{"version":3,"names":["signInWithPopup","GoogleAuthProvider","FacebookAuthProvider","signOut","onAuthStateChanged","signInWithEmailAndPassword","createUserWithEmailAndPassword","getIdTokenResult","authClient","useState","useEffect","createContext","googleProvider","facebookProvider","AuthContext","undefined","getCurrentUserIdToken","user","currentUser","console","log","token","getIdToken","substring","error","message","code","useAuth","_s","setUser","loading","setLoading","unsubscribe","authUser","signInWithGoogle","result","Error","signInWithFacebook","signInWithEmail","email","password","userCredential","registerWithEmail","signOutUser","listenToAuthChanges","callback","checkAdminStatus","idTokenResult","claims","admin"],"sources":["C:/Users/negis/OneDrive/Desktop/new project/blockfest-ui/src/firebase/auth.ts"],"sourcesContent":["// src/firebase/auth.ts\r\nimport {\r\n    signInWithPopup,\r\n    GoogleAuthProvider,\r\n    FacebookAuthProvider,\r\n    signOut,\r\n    onAuthStateChanged,\r\n    User,\r\n    signInWithEmailAndPassword,\r\n    createUserWithEmailAndPassword,\r\n    getIdToken,\r\n    getIdTokenResult\r\n} from \"firebase/auth\";\r\nimport { authClient } from \"./config\"; // Use the configured client auth instance\r\nimport { useState, useEffect, createContext } from 'react';\r\n\r\nconst googleProvider = new GoogleAuthProvider();\r\nconst facebookProvider = new FacebookAuthProvider();\r\n\r\n// Define the auth context type\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    loading: boolean;\r\n}\r\n\r\n// Export the auth context\r\nexport const AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\n// --- Get ID Token (for Backend Auth) ---\r\nexport const getCurrentUserIdToken = async (): Promise<string | null> => {\r\n    try {\r\n        // First try to get the current user\r\n        const user = authClient.currentUser;\r\n        if (!user) {\r\n            console.log('No user is currently logged in');\r\n            return null;\r\n        }\r\n\r\n        // Try to get the ID token\r\n        const token = await user.getIdToken();\r\n        if (!token) {\r\n            console.log('No ID token obtained');\r\n            return null;\r\n        }\r\n\r\n        console.log('Successfully obtained Firebase token:', token.substring(0, 20) + '...');\r\n        return token;\r\n    } catch (error: any) {\r\n        console.error('Error getting Firebase token:', {\r\n            error,\r\n            message: error.message,\r\n            code: error.code\r\n        });\r\n        return null;\r\n    }\r\n};\r\n\r\n// --- Auth State Management ---\r\nexport const useAuth = () => {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onAuthStateChanged(authClient, async (authUser) => {\r\n            setUser(authUser);\r\n            setLoading(false);\r\n            \r\n            if (authUser) {\r\n                try {\r\n                    // Try to get the ID token immediately\r\n                    await authUser.getIdToken();\r\n                    console.log('Successfully verified user token');\r\n                } catch (error) {\r\n                    console.error('Error verifying user token:', error);\r\n                }\r\n            }\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    return { user, loading };\r\n};\r\n\r\n// --- Sign-in Functions ---\r\nexport const signInWithGoogle = async (): Promise<User | null> => {\r\n    try {\r\n        const result = await signInWithPopup(authClient, googleProvider);\r\n        return result.user;\r\n    } catch (error: any) {\r\n        console.error(\"Google Sign-in Error:\", error);\r\n        throw new Error(error.message || \"Google Sign-in failed.\");\r\n    }\r\n};\r\n\r\nexport const signInWithFacebook = async (): Promise<User | null> => {\r\n    try {\r\n        const result = await signInWithPopup(authClient, facebookProvider);\r\n        return result.user;\r\n    } catch (error: any) {\r\n        console.error(\"Facebook Sign-in Error:\", error);\r\n        throw new Error(error.message || \"Facebook Sign-in failed.\");\r\n    }\r\n};\r\n\r\nexport const signInWithEmail = async (email: string, password: string): Promise<User | null> => {\r\n    try {\r\n        const userCredential = await signInWithEmailAndPassword(authClient, email, password);\r\n        return userCredential.user;\r\n    } catch (error: any) {\r\n        console.error(\"Email Sign-in Error:\", error);\r\n        throw new Error(error.message || \"Email Sign-in failed.\");\r\n    }\r\n};\r\n\r\nexport const registerWithEmail = async (email: string, password: string): Promise<User | null> => {\r\n    try {\r\n        const userCredential = await createUserWithEmailAndPassword(authClient, email, password);\r\n        // Optionally send verification email here: await sendEmailVerification(userCredential.user);\r\n        return userCredential.user;\r\n    } catch (error: any) {\r\n        console.error(\"Email Registration Error:\", error);\r\n        // Handle errors like email already in use, weak password\r\n        throw new Error(error.message || \"Email Registration failed.\");\r\n    }\r\n}\r\n\r\nexport const signOutUser = async () => {\r\n    try {\r\n        await signOut(authClient);\r\n    } catch (error: any) {\r\n        console.error(\"Sign-out Error:\", error);\r\n        throw new Error(error.message || \"Sign-out failed.\");\r\n    }\r\n};\r\n\r\n// --- Auth State Listener ---\r\n\r\nexport const listenToAuthChanges = (callback: (user: User | null) => void) => {\r\n    // Returns the unsubscribe function\r\n    return onAuthStateChanged(authClient, callback);\r\n};\r\n\r\n// --- Check Admin Claim ---\r\nexport const checkAdminStatus = async (): Promise<boolean> => {\r\n    if (!authClient.currentUser) {\r\n        return false;\r\n    }\r\n    try {\r\n        const idTokenResult = await getIdTokenResult(authClient.currentUser);\r\n        return idTokenResult.claims.admin === true;\r\n    } catch (error) {\r\n        console.error(\"Error getting ID token result/claims:\", error);\r\n        return false;\r\n    }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}